@using JasperSiteCore.Models.Database
@model JasperSiteCore.Areas.Admin.ViewModels.SettingsViewModel
@inject IJasperDataServicePublic J;
@{
    ViewData["Title"] = "Závažná chyba";
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="~/Areas/Admin/Content/Images/favicon.ico" type="image/x-icon">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instalace</title>


    @*********************************************************************** Styles ****************************************************************************@
    <environment include="Development">

        <link rel="stylesheet" href="~/node_modules/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="~/Areas/Admin/Content/Styles/design.css" />
        <link rel="stylesheet" href="~/Areas/Admin/Content/Styles/simple-sidebar.css" />
        <link href="~/node_modules/font-awesome/css/font-awesome.css" rel="stylesheet" />

    </environment>

    <environment exclude="Development">


        <link href="~/node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />


        <link href="~/Areas/Admin/Content/Styles/design-with-sidebar.min.css" rel="stylesheet" />

        <link href="~/node_modules/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    </environment>

    @*********************************************************************** Scripts ****************************************************************************@
    <environment include="Development">
        <script src="~/node_modules/jquery/dist/jquery.js"></script>       
        <script src="~/node_modules/bootstrap/dist/js/bootstrap.js"></script>

        <script src="~/node_modules/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>
    </environment>

    <environment exclude="Development">

        <script src="~/node_modules/jquery/dist/jquery.min.js"></script>
        <script src="~/node_modules/popper.js/dist/umd/popper.min.js"></script>
        <script src="~/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="~/node_modules/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.min.js"></script>

    </environment>
    <!--Used by _SuccessModalPartialViewTemp.cshtml -->
    <script src="~/Areas/Admin/Content/Scripts/SavedInfoPanel.js"></script>

    @{Html.RenderPartial("_ValidationScriptsPartial");}


    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dancing+Script" rel="stylesheet">


    <style>
        .j-header-color {
            color: #BA68C8;
        }
    </style>
    <script>
        $(document).ready(function () {
            $("[name='reloadButton']").click(function () {
                location.reload();
            });
        });
    </script>

</head>

<body>

    @{

        List<string> errorMessages = new List<string>();

        void Recursion(Exception ex)
        {
            if (ex != null)
            {
                errorMessages.Add($" {ex.ToString()}, <b>{ex.Message}</b>");
                if (ex.InnerException != null)
                {
                    Recursion(ex.InnerException);

                }
                else return;
            }
            else return;
        }

        Recursion((Exception)(TempData["ExceptionMessage"]));

        try
        {
            (errorMessages[0]) = "<b>Hlavní chyba:</b> "  + errorMessages[0];
            if (errorMessages.Count > 1)
            {
                for (int i = 0; i <= errorMessages.Count(); i++)
                {
                    if (i != 0)
                    {

                        errorMessages[i] = "<i>Inner Exception:</i> " + errorMessages[i];
                    }


                }

            }
        }
        catch { }
    }

    <div id="headerPanel"></div> @*Panel for appended success message *@

    <div class="container">

        @if (User.Identity.IsAuthenticated)
        {
            <h1>J<span class="j-header-color">asp</span>er Site <span class="j-header-color">Core</span></h1>
            <h2><small>Detekovány závažné chyby</small></h2>

            <div class="row">

                <div class="col-lg-12">
                    <section class="j-admin-section ">
                        <p>
                            Na této stránce se nachází seznam všech chyb, které je potřeba opravit, než
                            bude možné redakční systém spolehlivě používat.
                        </p>



                        @if (TempData["ErrorInPageLevelCode"] != null)
                        {
                            if ((string)(TempData["ErrorInPageLevelCode"]) == "1")
                            {
                                <div class="alert alert-warning">
                                    Na požadované stránce se nachází chyba, kterou je nutné opravit.
                                </div>
                            }

                        }


                        @if (errorMessages.Count > 0)
                        {
                            @foreach (string message in errorMessages)
                            {

                                <div class="alert alert-danger">
                                    @Html.Raw(message)
                                </div>
                            }

                        }
                        else
                        {
                            @*<div class="alert alert-warning">
                   Žádné podrobnosti k chybám nejsou k dispozici.
                </div>*@

                        }
                    </section>

                    @if (User.IsInRole("Admin"))
                    {
                        <div class="j-admin-section">

                            <p>
                                <b>Administrátorská sekce:</b> <br />
                                Vítejte uživateli @User.Identity.Name. Tuto sekci vidíte, protože máte roli <b>Admin</b>. <br />
                                <a class="btn btn-jasper btn-user-icon" style="left:5px;" asp-controller="Login" asp-area="admin" asp-action="SignOut"><i class="fa fa-undo fa-1x"> </i> Odhlásit uživatele <i> @User.Identity.Name</i></a>
                                <a class="btn btn-jasper btn-user-icon" style="left:5px;" asp-controller="Home" asp-area="admin" asp-action="Index"><i class="fa fa-diamond fa-1x"> </i> Přejít do administrace</a>
                                <a name="reloadButton" class="btn btn-jasper btn-user-icon" style="left:5px;"><i class="fa fa-refresh"> </i> Načíst tuto stránku znovu</a>
                            </p>

                            <p>
                                <br /><b>Řešení problémů:</b> <br />

                                <table class="table j-table-no-hover table-bordered">
                                    <tr><th>Akce</th><th>Popis</th></tr>
                                    <tr><td style="padding:5px"><a style="width:350px;" class="btn btn-jasper" asp-controller="Home" asp-action="Refresh" asp-area="Admin">Aktualizovat a aplikovat</a></td><td>Všechny změny v globálních a vzhledových souborech jasper.json budou aplikovány.</td></tr>
                                    <tr><td style="padding:5px"><a style="width:350px;" class="btn btn-jasper" asp-controller="Themes" asp-action="UpdateAllThemesData" asp-area="Admin">Aktualizovat a aplikovat pouze vzhledy</a></td><td>Zkontroluje integritu evidovaných vzhledů a aktualizuje konfigurační nastevení všech vzhledů.</td></tr>
                                    <tr><td style="padding:5px"><a style="width:350px;" class="btn btn-jasper" asp-controller="Themes" asp-action="UpdateConfiguration" asp-area="Admin">Pouze aktualizovat</a></td><td>Všechny změny v globálních a vzhledových souborech jasper.json budou načteny do paměti, ale změny týkající se vzhledů nebudou aplikovány.</td></tr>
                                    <tr><td style="padding:5px"><a style="width:350px;" class="btn btn-jasper" asp-controller="Themes" asp-action="ReconstructAllThemesCorrespondingDatabaseTables" asp-area="Admin">Rekonstrukce databáze vzhledů</a></td><td>V případě poškození databáze vzhledů tato možnost zresetuje databázi vzhledů a odstraní přiřazené textové bloky k jednotlivým kontejnerům příslušných vzhledů. </td></tr>
                                </table>

                            </p>


                        </div>

                        <section class="j-admin-section">
                            <h4><i class="fa fa-diamond j-icon" aria-hidden="true"></i>Globální konfigurační soubor jasper.json</h4>

                            <div id="mainForm2">
                                @Html.Partial("JasperJsonPartialView", Model.model2)
                            </div>
                        </section>

                        <section class="j-admin-section">
                            <h4><i class="fa fa-paint-brush j-icon" aria-hidden="true"></i>Vzhledový konfigurační soubor jasper.json</h4>

                            <div id="mainForm3">
                                @Html.Partial("JasperJsonThemePartialView", Model.model3)
                            </div>
                        </section>
                    }

                    @if (!User.IsInRole("Admin"))
                    {
                        <div class="j-admin-section">

                            <b>Sekce uživatele systému:</b> <br />
                            Vítejte uživateli @User.Identity.Name. Tuto sekci vidíte, protože jste přihlášen, ale nemáte administrátorská práva. Pro více možností se přihlašte jako administrátor. <br />
                            <a class="btn btn-jasper btn-user-icon" style="left:5px;" asp-controller="Login" asp-area="admin" asp-action="SignOut"><i class="fa fa-undo fa-1x"> </i> Odhlásit uživatele <i> @User.Identity.Name</i></a>
                            <a class="btn btn-jasper btn-user-icon" style="left:5px;" asp-controller="Home" asp-area="admin" asp-action="Index"><i class="fa fa-diamond fa-1x"> </i> Přejít do administrace</a>

                        </div>

                    }






                </div>
            </div>
        }
        else
        {
            @* Page for normal visitor *@

            <div class="jumbotron">
                <h1>
                    @{ string websiteHeader = J.GetWebsiteName();
                        @if (websiteHeader == null)
                        {
                            websiteHeader = "Omlouváme se, ";
                        } }

                @websiteHeader
            </h1>
            <h4>stránka je momentálně mimo provoz </h4>
        </div>

        <div class="row">

        </div>

        <footer>
            <hr />
            Tento web využívá redakční systém JasperSiteCore.
            <a asp-controller="Login" asp-action="Index" asp-area="Admin">Přihlásit se</a>
        </footer>
    }
    </div>


</body>
</html>
