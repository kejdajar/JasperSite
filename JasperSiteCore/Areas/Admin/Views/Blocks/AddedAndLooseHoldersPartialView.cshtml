@using JasperSiteCore.Models.Database
@using  JasperSiteCore.Models
@using JasperSiteCore.Areas.Admin.Controllers
@inject IJasperDataServicePublic J
@model JasperSiteCore.Areas.Admin.ViewModels.AddedAndLooseHoldersViewModel

@Html.Partial("_SuccessModalPartialViewTemp")
@Html.Partial("_ErrorModalPartialViewTemp")

<script>
        /* AJAX REMOVE HOLDER */
        $(document).ready(function () {


            var allDeleteLinks = $('a[data-remove-holder-id]').click(function (e) {

                e.preventDefault();
                var singleLink = $(this);

                var holderToBeRemovedId = singleLink.data('removeHolderId');
                var tbToBeRemovedId = @Model.CurrentTextBoxId;

                $.ajax({
                    type: 'get',
                    url: '@Url.Action("RemoveHolderFromBlock","Blocks")',
                    data: { holderId: holderToBeRemovedId, blockId:tbToBeRemovedId },
                    dataType: 'HTML',
                    success: function (data) {

                        $("#mainForm2").html(data);

                      //  savedInfo("<strong>Uloženo.</strong> Veškeré provedené změny byly uloženy.", "alert-success");
                    }
                });
            });
    });


    /* AJAX ADD HOLDER TO BLOCK*/
    $(document).ready(function () {


            var allAddLinks = $('a[data-add-holder-id]').click(function (e) {
     
                e.preventDefault();
                var singleLink = $(this);

                var holderToBeAddedId = singleLink.data('addHolderId');
                var tbId = @Model.CurrentTextBoxId;

                $.ajax({
                    type: 'get',
                    url: '@Url.Action("AddHolderToBlock","Blocks")',
                    data: { holderId: holderToBeAddedId, blockId:tbId },
                    dataType: 'HTML',
                    success: function (data) {

                        $("#mainForm2").html(data);

                        //savedInfo("<strong>Uloženo.</strong> Veškeré provedené změny byly uloženy.", "alert-success");
                    }
                });
            });
    });


    /* ORDER SUBMIT */
    $(document).ready(function () {


            var allAddLinks = $('[name="orderSubmit"]').click(function (e) {

                e.preventDefault();
                var singleLink = $(this);

                var holderId = singleLink.data('orderHolderId');
                var blockId = singleLink.data('orderBlockId');
                var order = $('[data-input-order-id="' + holderId + ',' + blockId + '"]').val();          

                $.ajax({
                    type: 'post',
                    url: '@Url.Action("SaveTextBlockOrder", "Blocks")',
                    data: { textBlockId: blockId, holderId: holderId, order: order },
                    dataType: 'HTML',
                    success: function (data) {

                        $("#mainForm2").html(data);

                       // savedInfo("<strong>Uloženo.</strong> Veškeré provedené změny byly uloženy.", "alert-success");
                    }
                });
            });
        });

</script>

<script>
    $(document).ready(function () {


        //$('[data-toggle="tooltip"]').tooltip();


    });
</script>

<section class="j-admin-section">

    <h2> <i class="fa fa-thumb-tack j-icon" aria-hidden="true"></i>Přiřazené kontejnery:</h2>

    @if (Model.CorrespondingBlockHolders.Count() > 0)
    {<table class="table table-bordered j-table j-left-border-block">
            <tr><th>Akce</th><th  style="min-width:150px">Název kontejneru</th><th class="col-sm-1">Název vzhledu</th><th >Pořadí bloku</th></tr>
            @foreach (BlockHolder holder in Model.CorrespondingBlockHolders)
            {
                <tr>
                    <td>   <a data-toggle="tooltip" title="Odebrat" asp-area="Admin" asp-controller="Blocks" asp-action="RemoveHolderFromBlock" asp-route-holderId="@holder.Id" asp-route-blockId="@Model.CurrentTextBoxId" class="btn btn-jasper btn-jasper-delete" data-remove-holder-id="@holder.Id" > <i class="fa fa-minus fa-1x" aria-hidden="true"></i>  </a></td>
                    @{var holder_block = J.GetHolder_Block(Model.CurrentTextBoxId, holder.Id);}
                    <td>@holder.Name</td>
                  <td>@holder.Theme.Name</td>
  
                  <td>
                      <form class="form-inline" style="min-width:150px" method="post" asp-controller="Blocks" asp-action="SaveTextBlockOrder" asp-area="admin">
                          <div class="form-group">
                              <input type="number" class="form-control" value="@holder_block.Order" name="order" style="width:100px" data-input-order-id="@holder.Id,@Model.CurrentTextBoxId">
                              <input type="hidden" name="holderId" value="@holder.Id" />
                              <input type="hidden" name="textBlockId" value="@Model.CurrentTextBoxId" />
                          </div>

                          <button type="submit" data-toggle="tooltip" title="Uložit pořadí" class="btn btn-jasper" data-order-block-id="@Model.CurrentTextBoxId" data-order-holder-id="@holder.Id" name="orderSubmit"> <i class="fa fa-floppy-o fa-1x" aria-hidden="true"></i>  </button>


                      </form>

                     
                  </td>

                  </tr>
            }
        </table>
    }
    else
    {
        <div class="alert alert-warning" role="alert">
            <strong>Upozornění:</strong> Tento textový blok nemá přiřazen zatím žádný kontejner a proto nebude zobrazen na stránce.
        </div>

    }

</section>


<section class="j-admin-section">

    <h2> <i class="fa fa-plus-circle j-icon" aria-hidden="true"></i>Přiřadit kontejnery:</h2>
    @if (Model.AllBlockHolders.Except(Model.CorrespondingBlockHolders).Count() > 0)
    {


        <table class="table table-bordered j-table j-table-left j-left-border-block">
            <tr><th>Akce</th><th style="min-width:150px">Název kontejneru</th><th class="col-sm-1">Název vzhledu</th></tr>
            @foreach (BlockHolder holder in Model.AllBlockHolders.Except(Model.CorrespondingBlockHolders))
            {
                <tr>
                    <td><a data-toggle="tooltip" title="Přiřadit" asp-area="Admin" asp-controller="Blocks" asp-action="AddHolderToBlock" asp-route-holderId="@holder.Id" asp-route-blockId="@Model.CurrentTextBoxId" class="btn btn-jasper" data-add-holder-id="@holder.Id"> <i class="fa fa-plus fa-1x" aria-hidden="true"></i>  </a></td>
                    <td>@holder.Name</td>
                    <td>@holder.Theme.Name</td>
                </tr>
            }
        </table>
    }
    else
    {
        <div class="alert alert-warning" role="alert">
            <strong>Upozornění:</strong> Žádné další kontejnery nemá aktivní vzhled k dispozici.
        </div>

    }



    <div class="form-group">

        <a href="/Admin/Blocks/" class=" btn btn-secondary"><i class="fa fa-undo" aria-hidden="true"></i> Zpět na seznam bloků</a>





    </div>

</section>

